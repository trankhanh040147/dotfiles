{"fsPath":"/home/khanh/src/0_github/langtut/internal/debuglog/debuglog.go","fileUuid":"4421bb60-3ab0-49f7-b476-44b12220fea3","fileSizeBytes":1701,"numLines":64,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":65,"addedLines":["package debuglog","","import (","\t\"encoding/json\"","\t\"os\"","\t\"sync\"","\t\"time\"",")","","const logPath = \"/home/khanh/src/0_github/langtut/.cursor/debug.log\"","","var throttleMu sync.Mutex","var throttleLast = make(map[string]int64)","var throttleInterval = int64(2000) // ms","","type entry struct {","\tID           string                 `json:\"id\"`","\tTimestamp    int64                  `json:\"timestamp\"`","\tLocation     string                 `json:\"location\"`","\tMessage      string                 `json:\"message\"`","\tData         map[string]interface{} `json:\"data\"`","\tHypothesisID string                 `json:\"hypothesisId,omitempty\"`","\tRunID        string                 `json:\"runId,omitempty\"`","}","","func Log(location, message string, data map[string]interface{}, hypothesisID string) {","\tdoLog(location, message, data, hypothesisID)","}","","func LogThrottled(key, location, message string, data map[string]interface{}, hypothesisID string) {","\tnow := time.Now().UnixMilli()","\tthrottleMu.Lock()","\tlast, ok := throttleLast[key]","\tif ok && now-last < throttleInterval {","\t\tthrottleMu.Unlock()","\t\treturn","\t}","\tthrottleLast[key] = now","\tthrottleMu.Unlock()","\tdoLog(location, message, data, hypothesisID)","}","","func doLog(location, message string, data map[string]interface{}, hypothesisID string) {","\te := entry{","\t\tID:           \"log_\" + time.Now().Format(\"20060102150405.000\"),","\t\tTimestamp:    time.Now().UnixMilli(),","\t\tLocation:     location,","\t\tMessage:      message,","\t\tData:         data,","\t\tHypothesisID: hypothesisID,","\t}","\tif data == nil {","\t\te.Data = map[string]interface{}{}","\t}","\tb, _ := json.Marshal(e)","\tb = append(b, '\\n')","\tf, err := os.OpenFile(logPath, os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)","\tif err != nil {","\t\treturn","\t}","\tf.Write(b)","\tf.Close()","}",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000005,1000006,1000007,1000001,1000008,1000001,1000009,1000010,1000011,1000001,1000012,1000013,1000014,1000015,1000016,1000017,1000018,1000019,1000020,1000001,1000021,1000022,1000020,1000001,1000023,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000022,1000020,1000001,1000033,1000034,1000035,1000036,1000037,1000038,1000039,1000040,1000030,1000041,1000042,1000030,1000043,1000044,1000045,1000046,1000029,1000030,1000047,1000048,1000020,1000001]}],"gitInfo":{"gitInfo":{"gitRoot":"/home/khanh/src/0_github/langtut","branch":"feat/v0.1.0_write_mode","commitHash":"ccab69e2dccdd4deb43c79cdfbf9d87ea1e9c19d"}},"kind":"KIND_ADDED"}